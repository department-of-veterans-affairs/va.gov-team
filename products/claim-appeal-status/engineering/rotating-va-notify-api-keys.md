# Rotating VA Notify API Keys (for Benefits Management Tools)

## Overview

VA Notify API keys must be rotated every **180 days** for security compliance. This document outlines the process for rotating the Benefits Decision Review API keys.

## Key Information

### API Key Format

The VA Notify API key is constructed from three values:
```
#{key-name}-#{service-id}-#{secret}
```

### Rotation Schedule

- **Frequency**: Every 180 days
- **Key Delivery**: New keys are generated and sent via encrypted email to the designated group
- **Activation**: New keys are active immediately upon generation
- **Validity**: Each key is valid for 180 days from generation

## Rotation Process

### Step 1: Receive New API Key

New keys will be generated by the VA Notify team and sent via encrypted email to the designated group.

### Step 2: Update AWS Parameter Store

Update the following parameters in AWS Parameter Store with the new API key:

> ⚠️ **Important:** Do not update the production parameter until staging has been fully tested and verified (see Step 6 below).

**Staging Environment:**
```
/dsva-vagov/vets-api/staging/env_vars/vanotify/services/benefits_management_tools/api_key
/dsva-vagov/vets-api/staging/env_vars/vanotify/services/benefits_management_tools/push_api_key
```

**Production Environment:**
```
/dsva-vagov/vets-api/prod/env_vars/vanotify/services/benefits_management_tools/api_key
/dsva-vagov/vets-api/prod/env_vars/vanotify/services/benefits_management_tools/push_api_key
```


**Instructions:**
1. Navigate to AWS Systems Manager → Parameter Store
2. Locate each parameter path above
3. Update the "value" text field with the API Key
4. Save changes

### Step 3: Wait for Deployment and Verify Settings

After updating the AWS Parameter Store, you must wait for vets-api to deploy before testing. This typically occurs the following day.

**Verify the API Keys in Rails Console:**

1. Access the Rails console via [Argo Staging](https://argocd.vfs.va.gov/applications/vets-api-staging) in the CAG environment
2. Run the following commands to verify the API key has been updated:

```ruby
Settings.vanotify.services.benefits_management_tools.api_key
Settings.vanotify.services.benefits_management_tools.push_api_key
```

3. Confirm that the output matches the new API key you updated in AWS Parameter Store

> **Important:** Do not proceed to testing until this value reflects the changes made in AWS Parameter Store.

### Step 4: Test in Staging

After verifying the settings have been updated, test the new key using test data.

1. Login as [test user](https://github.com/department-of-veterans-affairs/va.gov-team-sensitive/blob/master/Administrative/vagov-users/mvi-staging-users.csv), noting its ICN
2. Change the [user's email](https://staging.va.gov/profile/contact-information) to an address you have access to
3. Open a rails console on [vets-api-staging](https://argocd.vfs.va.gov/applications/vets-api-staging)
4. Execute this code to get the participant_id of the test user
```ruby
mpi_service = MPI::Service.new
icn='[ICN of test user]'
mpi_service.find_profile_by_identifier(identifier: icn, identifier_type: 'ICN')&.profile.participant_id
```
5. Open a rails console on [eventbus-gateway-staging](https://argocd.vfs.va.gov/applications/eventbus-gateway-staging)
6. Execute this code to trigger a notification email to yourself
```ruby
consumer = DecisionLetterAvailabilityConsumer.new
veteran_id="[participant_id of test user]"
claim_type_code="310RTPIDES"

response = consumer.send(:send_notifications, veteran_id, claim_type_code)
puts "Push and email notification sent successfully: #{response.success?}"
puts "Response status: #{response.status}"
puts "Response body: #{response.body}"

```
7. Check your email inbox for the test email

### Step 5: Update Production

Once staging is verified:
1. Update the production parameter in AWS Parameter Store
2. Monitor production [Datadog dashboard](https://vagov.ddog-gov.com/dashboard/diy-2n4-4my/bmt---eventbus-gateway) and the [#benefits-management-tools-ev-gateway-alerts](https://dsva.slack.com/archives/C09DE77DRA6) slack channel for any issues

## Future Improvements

The VA Notify team is working on a UI feature that will enable developers to self-service API key generation. This feature will be available in the same interface where email templates are currently managed.

Until the self-service feature is available, key rotation will continue to be handled manually as described above.

## Responsibilities

- **Team Responsibility**: It is the Decision Reviews team's responsibility to manage key rotation
- **Action Item**: Update keys in AWS Parameter Store upon receipt from VA Notify
- **Documentation**: Keep this document updated with any process changes

## Contact

For issues with key rotation or VA Notify integration, contact:
- **VA Notify Team**: #va-notify-public (Slack)
- **Platform Support**: #vfs-platform-support (Slack)

## Last Updated

Document created: 1/2/2026
