# Find a Form data README

## Lighthouse VA Forms API documentation
https://developer.va.gov/explore/api/va-forms - Documentation for API that indexes data sourced from VA.gov, Lighthouse


## Date contexts
(Housing here for lack of better location.)
The Forms DB includes 2 dates that are migrated to Drupal: 
1. **Revision date** - date that is on the form itself in the lower left hand corner. Reflects the date when the form was created. 
    * A contractor makes changes/edits to the actual form, and they own updates to this date in the form.
    * Revision date is manually updated in the Forms DB.
    * Veterans submitting a form using an old revision may be required to re-submit using the latest revision.
2. **Issue date** - date that updated form is uploaded to the Form DB.
    * Will increment anytime the Revision Date increments
    * May also increment for background changes that do not change the Revision Date, such as updating Adobe certificates for the PDF. 
    * Issue date is manually entered in Forms DB, so in some cases a PDF may get updated without Issue Date reflecting a change.
    
Because both dates are manually entered in the Forms DB, and Drupal does not validate in any way, future dates may be entered for either date.

**Use of day**
Dates are stored in the Forms DB as month/year, and do not include a day.
In Drupal, day is required and generated by the system during Forms DB migration.

**Front-end display in Find-a-form**
(Sept 2024) The Find a Form product displays the form's revision date in `Month Year` format with the label "Form revision date." ([c-b PR](https://github.com/department-of-veterans-affairs/content-build/pull/2280/files), [v-w PR)](https://github.com/department-of-veterans-affairs/vets-website/pull/32039/files)

Forms are not guaranteed to have a Revision Date. In the case of a missing Revision Date, the Lighthouse Forms API will return an Issue date for that field instead. ([Details from LH](https://dsva.slack.com/archives/CUB5X5MGF/p1740755074593239))

**Example date display**
So for a form where: 
* `Revision date in Forms DB = 05/2022`
* `Issue date in Forms DB = 06/2023`

The Drupal CMS will store: 
* `Revision date = 05/01/2022`
* `Issue date = 06/01/2023`

And the front-end of the Find a Form product will show: 
* `Form revision date: May 2022`


# Forms data that should not appear on VA.gov (March 2025)

## Deleted forms
* **In the FormsDB**: Forms marked Deleted = true, and DeletedAt = contains a timestamp
* **In Drupal**: When Drupal imports forms where Deleted = true, Drupal marks the VA Form node as archived, and stores the Deleted = true / DeletedAt timestamp on the node.
* **In Lighthouse Forms API:**
    * Lighthouse receives the Deleted and DeletedAt values from Forms DB (via Drupal migration) and stores / returns those values in API responses. 
    * Forms are marked as validPdf = false. I believe Lighthouse analyzes PDF URLs and sets this value in their API -- it does not come from FormsDB or Drupal. 
    * Deleted forms are not excluded from the API, and the API does not include an API parameter that allows excluding deleted forms from API responses. 
* **On VA.gov:** We have application logic in Find a Form that does not display form in search results if form data includes validPdf = false. 
    * This is working correctly when searching by Form ID. 
    * It is not working correctly all the time when searching by Form Name. (some forms with validPDF = false appear in search results.) This is a bug.

## IntranetOnly forms
* **In the FormsDB**: Forms are marked IntranetOnly = 1
* **In Drupal**: When Drupal imports forms with IntranetOnly = 1, Drupal now marks them archived.
Drupal does not save the IntranetOnly field value onto the Drupal node, so it cannot currently be passed on to Lighthouse.
* **In Lighthouse Forms API**: Lighthouse does not see, handle, or store the IntranetOnly value, and does not process any Drupal publishing states. These forms continue to return as valid forms in Lighthouse Forms API search results. However: the PDF link for IntranetOnly forms often 404s from off VA network, which means Lighthouse sets validPDF = false.
We have suggested (in Slack) that Lighthouse could exclude Drupal publishing status = Archived from their GraphQL query, to exclude these results.
Alternatively: We could store the IntranetOnly value in Drupal, and Lighthouse could then store it as they do with Deleted / DeletedAt.
* **On VA.gov**: Forms continue to appear on VA.gov if validPDF = true (if PDF link is reachable); "form not valid" message is returned if validPDF = false. BUT: Same bug is in play for these results:
    * This is working correctly when searching by Form ID. 
    * Some validPDF = false forms show up when searching by title. 

## Docusign only forms
* **In the FormsDB**: No FormsDB field indicates Docusign only. The examples we have just include Docusign in the PDF link text. (29-10277, 29-0975e, 29-10277) , or it is not indicated anywhere in data we receive (22-10203, was noted in a 2024 email thread with Forms mgrs).
* **In Drupal**: We don't do any special handling for DocuSign. We look at Deleted or IntranetOnly values only, to determine whether or not to archive. 
* **In Lighthouse Forms API**: Lighthouse does not do any special handling. 
* **On VA.gov**: Forms continue to appear on VA.gov if validPDF = true; "form not valid" message is returned if validPDF = false. BUT: Same bug is in play for these results:
    * This is working correctly when searching by Form ID. 
    * Some validPDF = false forms show up when searching by title. 
